!function(e){"use strict";var t=function(t,n){var r=e.fn.typeahead.defaults;if(n.scrollBar){n.items=100;n.menu='<ul class="typeahead dropdown-menu" style="max-height:220px;overflow:auto;"></ul>'}var i=this;i.$element=e(t);i.options=e.extend({},e.fn.typeahead.defaults,n);i.$menu=e(i.options.menu).insertAfter(i.$element);i.eventSupported=i.options.eventSupported||i.eventSupported;i.grepper=i.options.grepper||i.grepper;i.highlighter=i.options.highlighter||i.highlighter;i.lookup=i.options.lookup||i.lookup;i.matcher=i.options.matcher||i.matcher;i.render=i.options.render||i.render;i.onSelect=i.options.onSelect||null;i.sorter=i.options.sorter||i.sorter;i.source=i.options.source||i.source;i.displayField=i.options.displayField||i.displayField;i.valueField=i.options.valueField||i.valueField;if(i.options.ajax){var s=i.options.ajax;if(typeof s==="string"){i.ajax=e.extend({},e.fn.typeahead.defaults.ajax,{url:s})}else{if(typeof s.displayField==="string"){i.displayField=i.options.displayField=s.displayField}if(typeof s.valueField==="string"){i.valueField=i.options.valueField=s.valueField}i.ajax=e.extend({},e.fn.typeahead.defaults.ajax,s)}if(!i.ajax.url){i.ajax=null}i.query=""}else{i.source=i.options.source;i.ajax=null}i.shown=false;i.listen()};t.prototype={constructor:t,eventSupported:function(e){var t=e in this.$element;if(!t){this.$element.setAttribute(e,"return;");t=typeof this.$element[e]==="function"}return t},select:function(){var e=this.$menu.find(".active");var t=e.attr("data-value");var n=this.$menu.find(".active a").text();if(this.options.onSelect){this.options.onSelect({value:t,text:n})}this.$element.val(this.updater(n)).change();return this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});this.$menu.css({top:t.top+t.height,left:t.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},ajaxLookup:function(){function n(){this.ajaxToggleLoadClass(true);if(this.ajax.xhr)this.ajax.xhr.abort();var n=this.ajax.preDispatch?this.ajax.preDispatch(t):{query:t};this.ajax.xhr=e.ajax({url:this.ajax.url,data:n,success:e.proxy(this.ajaxSource,this),type:this.ajax.method||"get",dataType:"json"});this.ajax.timerId=null}var t=e.trim(this.$element.val());if(t===this.query){return this}this.query=t;if(this.ajax.timerId){clearTimeout(this.ajax.timerId);this.ajax.timerId=null}if(!t||t.length<this.ajax.triggerLength){if(this.ajax.xhr){this.ajax.xhr.abort();this.ajax.xhr=null;this.ajaxToggleLoadClass(false)}return this.shown?this.hide():this}this.ajax.timerId=setTimeout(e.proxy(n,this),this.ajax.timeout);return this},ajaxSource:function(e){this.ajaxToggleLoadClass(false);var t=this,n;if(!t.ajax.xhr)return;if(t.ajax.preProcess){e=t.ajax.preProcess(e)}t.ajax.data=e;n=t.grepper(t.ajax.data)||[];if(!n.length){return t.shown?t.hide():t}t.ajax.xhr=null;return t.render(n.slice(0,t.options.items)).show()},ajaxToggleLoadClass:function(e){if(!this.ajax.loadingClass)return;this.$element.toggleClass(this.ajax.loadingClass,e)},lookup:function(e){var t=this,n;if(t.ajax){t.ajaxer()}else{t.query=t.$element.val();if(!t.query){return t.shown?t.hide():t}n=t.grepper(t.source);if(!n){return t.shown?t.hide():t}if(n.length==0){n[0]={id:-21,name:"Result not Found"}}return t.render(n.slice(0,t.options.items)).show()}},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){if(!this.options.ajax){var t=[],n=[],r=[],i;while(i=e.shift()){if(!i.toLowerCase().indexOf(this.query.toLowerCase()))t.push(i);else if(~i.indexOf(this.query))n.push(i);else r.push(i)}return t.concat(n,r)}else{return e}},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this,r,i=typeof n.options.displayField==="string";t=e(t).map(function(t,s){if(typeof s==="object"){r=i?s[n.options.displayField]:n.options.displayField(s);t=e(n.options.item).attr("data-value",s[n.options.valueField])}else{r=s;t=e(n.options.item).attr("data-value",s)}t.find("a").html(n.highlighter(r));return t[0]});t.first().addClass("active");this.$menu.html(t);return this},grepper:function(t){var n=this,r,i,s=typeof n.options.displayField==="string";if(s&&t&&t.length){if(t[0].hasOwnProperty(n.options.displayField)){r=e.grep(t,function(e){i=s?e[n.options.displayField]:n.options.displayField(e);return n.matcher(i)})}else if(typeof t[0]==="string"){r=e.grep(t,function(e){return n.matcher(e)})}else{return null}}else{return null}return this.sorter(r)},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();if(!r.length){r=e(this.$menu.find("li")[0])}if(this.options.scrollBar){var i=this.$menu.children("li").index(r);if(i%8==0){this.$menu.scrollTop(i*26)}}r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();if(!n.length){n=this.$menu.find("li").last()}if(this.options.scrollBar){var r=this.$menu.children("li");var i=r.length-1;var s=r.index(n);if((i-s)%8==0){this.$menu.scrollTop((s-7)*26)}}n.addClass("active")},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",e.proxy(this.keydown,this))}this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this))},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault();this.prev();break;case 40:e.preventDefault();this.next();break}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]);this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:if(this.ajax)this.ajaxLookup();else this.lookup()}e.stopPropagation();e.preventDefault()},focus:function(e){this.focused=true},blur:function(e){this.focused=false;if(!this.mousedover&&this.shown)this.hide()},click:function(e){e.stopPropagation();e.preventDefault();this.select();this.$element.focus()},mouseenter:function(t){this.mousedover=true;this.$menu.find(".active").removeClass("active");e(t.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=false;if(!this.focused&&this.shown)this.hide()}};e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n==="object"&&n;if(!i)r.data("typeahead",i=new t(this,s));if(typeof n==="string")i[n]()})};e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',displayField:"name",scrollBar:false,valueField:"id",onSelect:function(){},ajax:{url:null,timeout:300,method:"get",triggerLength:1,loadingClass:null,preDispatch:null,preProcess:null}};e.fn.typeahead.Constructor=t;e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault();n.typeahead(n.data())})})}(window.jQuery)